<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="index.html">
            <img src="assets/images/T.png" alt="Teaching Torch" width="40" height="40" class="me-2">
            <span class="brand-text">Teaching Torch</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">
                        <i class="bi bi-house-fill me-1"></i>Home
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pages/about.html">
                        <i class="bi bi-info-circle-fill me-1"></i>About
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pages/contact.html">
                        <i class="bi bi-envelope-fill me-1"></i>Contact
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-book-fill me-1"></i>Grades
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="pages/grades/grade6/">Grade 6</a></li>
                        <li><a class="dropdown-item" href="pages/grades/grade7/">Grade 7</a></li>
                        <li><a class="dropdown-item" href="pages/grades/grade8/">Grade 8</a></li>
                        <li><a class="dropdown-item" href="pages/grades/grade9/">Grade 9</a></li>
                        <li><a class="dropdown-item" href="pages/grades/grade10/">Grade 10</a></li>
                        <li><a class="dropdown-item" href="pages/grades/grade11/">Grade 11</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="pages/grades/al/">
                            <i class="bi bi-mortarboard-fill me-1"></i>Advanced Level
                        </a></li>
                    </ul>
                </li>
            </ul>
            
            <!-- Language Filter and Theme Controls -->
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" id="languageToggle">
                        <i class="bi bi-translate me-1"></i>
                        <span id="currentLanguage">English</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item language-option" data-lang="english">
                            <i class="bi bi-circle-fill me-2 text-primary"></i>English
                        </a></li>
                        <li><a class="dropdown-item language-option" data-lang="sinhala">
                            <i class="bi bi-circle-fill me-2 text-warning"></i>සිංහල (Sinhala)
                        </a></li>
                        <li><a class="dropdown-item language-option" data-lang="tamil">
                            <i class="bi bi-circle-fill me-2 text-info"></i>தமிழ் (Tamil)
                        </a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <button class="nav-link btn btn-link" id="themeToggle" title="Toggle Dark Mode">
                        <i class="bi bi-moon-fill" id="themeIcon"></i>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
// Enhanced Navbar Functionality - NO NOTIFICATIONS
document.addEventListener('DOMContentLoaded', function() {
    initializeLanguageFilter();
    initializeThemeToggle();
});

// Language Filter System - No Notifications
function initializeLanguageFilter() {
    const currentLang = localStorage.getItem('selectedLanguage') || 'english';
    localStorage.setItem('selectedLanguage', currentLang);
    
    updateLanguageDisplay(currentLang);
    
    document.querySelectorAll('.language-option').forEach(option => {
        option.addEventListener('click', function(e) {
            e.preventDefault();
            const selectedLang = this.getAttribute('data-lang');
            setLanguage(selectedLang);
        });
    });
    
    setTimeout(() => {
        applyLanguageFilter(currentLang);
    }, 500);
}

function setLanguage(language) {
    localStorage.setItem('selectedLanguage', language);
    updateLanguageDisplay(language);
    applyLanguageFilter(language);
    
    window.dispatchEvent(new CustomEvent('languageChanged', { 
        detail: { language: language } 
    }));
    
    // NO NOTIFICATION - Removed showLanguageChangeNotification
}

function updateLanguageDisplay(language) {
    const currentLanguageSpan = document.getElementById('currentLanguage');
    const languageNames = {
        'sinhala': 'සිංහල',
        'tamil': 'தமිழ්',
        'english': 'English'
    };
    
    if (currentLanguageSpan) {
        currentLanguageSpan.textContent = languageNames[language] || 'English';
    }
    
    document.querySelectorAll('.language-option').forEach(option => {
        option.classList.remove('active');
        if (option.getAttribute('data-lang') === language) {
            option.classList.add('active');
        }
    });
}

function applyLanguageFilter(language) {
    document.querySelectorAll('.textbook-medium-card').forEach(card => {
        const cardClasses = card.className.toLowerCase();
        if (cardClasses.includes(language)) {
            card.style.display = 'block';
            card.style.opacity = '1';
        } else {
            card.style.display = 'none';
        }
    });
    
    document.querySelectorAll('[data-language]').forEach(item => {
        const itemLang = item.getAttribute('data-language');
        if (itemLang === language) {
            item.style.display = '';
            item.style.opacity = '1';
        } else {
            item.style.display = 'none';
        }
    });
    
    document.querySelectorAll('.note-card').forEach(card => {
        const cardLang = card.getAttribute('data-language');
        if (cardLang === language || cardLang === null) {
            if (cardLang === null && language === 'english') {
                card.style.display = 'flex';
                card.style.opacity = '1';
            } else if (cardLang === language) {
                card.style.display = 'flex';
                card.style.opacity = '1';
            } else {
                card.style.display = 'none';
            }
        } else {
            card.style.display = 'none';
        }
    });
    
    document.querySelectorAll('.video-card').forEach(card => {
        const cardLang = card.getAttribute('data-language');
        if (cardLang === language || cardLang === null) {
            if (cardLang === null && language === 'english') {
                card.style.display = 'block';
                card.style.opacity = '1';
            } else if (cardLang === language) {
                card.style.display = 'block';
                card.style.opacity = '1';
            } else {
                card.style.display = 'none';
            }
        } else {
            card.style.display = 'none';
        }
    });
    
    document.querySelectorAll('.paper-item-enhanced, .paper-item').forEach(item => {
        const itemLang = item.getAttribute('data-language');
        if (itemLang === language || itemLang === null) {
            if (itemLang === null && language === 'english') {
                item.style.display = 'flex';
                item.style.opacity = '1';
            } else if (itemLang === language) {
                item.style.display = 'flex';
                item.style.opacity = '1';
            } else {
                item.style.display = 'none';
            }
        } else {
            item.style.display = 'none';
        }
    });
    
    hideEmptySections();
    
    if (typeof updateResourceCounts === 'function') {
        updateResourceCounts();
    }
}

function hideEmptySections() {
    document.querySelectorAll('.subject-section').forEach(section => {
        const visibleItems = section.querySelectorAll(`
            .textbook-medium-card:not([style*="display: none"]), 
            .note-card:not([style*="display: none"]), 
            .video-card:not([style*="display: none"]), 
            .paper-item-enhanced:not([style*="display: none"]),
            .paper-item:not([style*="display: none"])
        `);
        
        if (visibleItems.length === 0) {
            section.style.display = 'none';
        } else {
            section.style.display = 'block';
        }
    });
    
    document.querySelectorAll('.paper-category-section').forEach(section => {
        const visiblePapers = section.querySelectorAll('.paper-item-enhanced:not([style*="display: none"])');
        if (visiblePapers.length === 0) {
            section.style.display = 'none';
        } else {
            section.style.display = 'block';
        }
    });
}

// Dark Mode System - No Notifications
function initializeThemeToggle() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    setTheme(savedTheme, false); // false = no notification
    
    const themeToggleBtn = document.getElementById('themeToggle');
    if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme, true); // true = show notification only when user clicks
        });
    }
}

function setTheme(theme, showNotification = false) {
    document.documentElement.setAttribute('data-theme', theme);
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    
    const themeIcon = document.getElementById('themeIcon');
    if (themeIcon) {
        if (theme === 'dark') {
            themeIcon.className = 'bi bi-sun-fill';
        } else {
            themeIcon.className = 'bi bi-moon-fill';
        }
    }
    
    window.dispatchEvent(new CustomEvent('themeChanged', { 
        detail: { theme: theme } 
    }));
    
    // Only show notification if explicitly requested (user clicked button)
    if (showNotification) {
        console.log(`${theme === 'dark' ? 'Dark' : 'Light'} mode activated`);
    }
}

function observeContentChanges() {
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                const currentLang = localStorage.getItem('selectedLanguage') || 'english';
                setTimeout(() => applyLanguageFilter(currentLang), 100);
            }
        });
    });
    
    const mainContent = document.getElementById('main-content');
    if (mainContent) {
        observer.observe(mainContent, { childList: true, subtree: true });
    }
}

document.addEventListener('DOMContentLoaded', function() {
    observeContentChanges();
});

// Export functions for global use
window.LanguageFilter = {
    setLanguage,
    applyLanguageFilter,
    getCurrentLanguage: () => localStorage.getItem('selectedLanguage') || 'english'
};

window.ThemeManager = {
    setTheme: (theme) => setTheme(theme, false), // No notification for programmatic changes
    getCurrentTheme: () => document.documentElement.getAttribute('data-theme') || 'light'
};

window.addEventListener('load', function() {
    const currentLang = localStorage.getItem('selectedLanguage') || 'english';
    applyLanguageFilter(currentLang);
});
</script>

<style>
.navbar-nav .nav-link.btn {
    border: none !important;
    background: none !important;
    color: rgba(255,255,255,0.8) !important;
    padding: 0.5rem !important;
    border-radius: 4px;
    transition: all 0.3s ease;
}

.navbar-nav .nav-link.btn:hover {
    color: white !important;
    background: rgba(255,255,255,0.1) !important;
    transform: scale(1.1);
}

.navbar-nav .nav-link.btn:focus {
    outline: 2px solid rgba(255,255,255,0.5);
    outline-offset: 2px;
}

.language-option.active {
    background-color: var(--primary) !important;
    color: white !important;
}

.language-option:hover {
    background-color: rgba(46, 125, 50, 0.1);
}

.dropdown-menu {
    border: none;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    border-radius: 10px;
    padding: 0.5rem 0;
}

.dropdown-item {
    padding: 0.5rem 1rem;
    transition: all 0.2s ease;
}

.dropdown-item:hover {
    background-color: var(--primary);
    color: white;
    transform: translateX(5px);
}
</style>